{
  "unpublishedCollection": {
    "name": "SpotifySettings",
    "pageId": "Spotify and YouTube",
    "pluginId": "js-plugin",
    "pluginType": "JS",
    "actions": [],
    "archivedActions": [],
    "body": "export default {\n\n\tauthDecisionMaker: async function () {\n\t\tconsole.log(\"STEP 2: Requesting either request or refresh token based on token validity\")\n\t\n\t\t\treturn this.requestCall()\n\t\t\t\t.then((s) => console.log(s.message) )\n\t\t\t\t.catch((e) => {\n\t\t\t\tconsole.log(e.messsage)\n\t\t\t\tif(requestToken.responseMeta.statusCode != '200') {\n\t\t\t\t\treturn this.refreshCall()\n\t\t\t\t}\n\t\t\t})\n\t},\t\n\n\t//-----Calling requestToken API and saving authorization code to store-----//\n\trequestCall: () => {\n\t\treturn requestToken.run()\n\t\t\t.then((response) => {\n\t\t\tconsole.log(\"STEP 3: *REQUEST CALL* Successfully ran requestToken query \")\n\t\t\tlet tokens = [\n\t\t\t\tstoreValue('authToken', response.access_token),\n\t\t\t\tstoreValue('refreshToken', response.refresh_token),\n\t\t\t]\n\t\t\treturn Promise.all(tokens)\n\t\t\t\t.then(() => {\t\n\t\t\t\tconsole.log(\"Auth code in store is \" + appsmith.store.authToken)\n\t\t\t\tconsole.log(\"Refresh token in store is \" + appsmith.store.refreshToken)\n\t\t\t})\n\t\t\t\t.catch((err) => { \n\t\t\t\tconsole.log(\"Could not store tokens in store\");\n\t\t\t\treturn showAlert('Could not store tokens in store ' + err.toString());\n\t\t\t})\n\t\t})\n\t},\n\n\t//-----Calling refreshToken and replacing auth code in store-----//\n\trefreshCall: () => {\n\t\tconsole.log(\"STEP 2: Attempting to refresh token\")\n\t\tconsole.log(\"*REFRESH CALL* Auth code before refresh is \\\\n\" + appsmith.store.authToken)\n\t\treturn refreshToken.run()\n\t\t\t.then((refreshResponse) => {\n\t\t\treturn storeValue('authToken', refreshResponse.access_token)\n\t\t\t\t.then(() => console.log(\"STEP 3: *REFRESH CALL* Auth code after refresh is \\\\n\" + appsmith.store.authToken))\n\t\t\t\t.catch(() => console.log(\"Failed to update auth code from refresh call\"))\n\t\t}).catch(() => {return null})\n\t}\n}",
    "variables": []
  },
  "id": "Spotify and YouTube_SpotifySettings",
  "deleted": false,
  "gitSyncId": "61ea4a44361846772cfb117d_6266b803cb603a05f907ff75"
}